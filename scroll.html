<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
      margin: 0px;
      padding: 0px;
      }
    </style>
  </head>
  <body>
    <table  style="margin-top:1em">
      <tbody>
        <tr>
        <!--
          <td align="center">
            <form action="#">
              form
            </form>
          </td>
        -->
          <td>
            <div>
              <canvas id="scroll" height="160" width="800" style="background-color:#000;border:solid #666 1px;"></canvas>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <script>

      function get(n){
        var half = location.search.split(n+'=')[1];
        return half? decodeURIComponent(half.split('&')[0]):null;
      }

      function bld() {
        var retval = [];
        for(var i=0; i<arguments.length; i++) {
          retval.push(new Msg(arguments[i]));
        }
        retval.push(new Msg("0"));
        return retval;
      }

      function translate(str) {
        var retval=[];
        for(var i=0; i<str.length; i++) {
          retval = retval.concat(window[str[i]]());
        }
        return retval;
      }  

      // lowercase needs variable width
      function A() { return bld("0011111","0100100","1000100","0100100","0011111"); }
      function B() { return bld("1111111","1001001","1001001","1001001","0110110"); }
      function C() { return bld("0111110","1000001","1000001","1000001","0100010"); }
      function D() { return bld("1111111","1000001","1000001","1000001","0111110"); }
      function E() { return bld("1111111","1001001","1001001","1001001","1000001"); }
      function F() { return bld("1111111","1001000","1001000","1001000","1000000"); }
      function G() { return bld("0111110","1000001","1000001","1000101","0100110"); }
      function H() { return bld("1111111","0001000","0001000","0001000","1111111"); }
      function I() { return bld("1000001","1000001","1111111","1000001","1000001"); }
      function J() { return bld("0000110","0000001","1000001","1111110","1000000"); }
      function K() { return bld("1111111","0001000","0010100","0100010","1000001"); }
      function L() { return bld("1111111","0000001","0000001","0000001","0000001"); }
      function M() { return bld("0111111","1000000","0111000","1000000","0111111"); }
      function N() { return bld("1111111","0100000","0010000","0001000","1111111"); }
      function O() { return bld("0111110","1000001","1000001","1000001","0111110"); }
      function P() { return bld("1111111","1001000","1001000","1001000","0110000"); }
      function Q() { return bld("0111110","1000001","1000101","1000011","0111110"); }
      function R() { return bld("1111111","1001000","1001100","1001010","0110001"); }
      function S() { return bld("0110010","1001001","1001001","1001001","0100110"); }
      function T() { return bld("1000000","1000000","1111111","1000000","1000000"); }
      function U() { return bld("1111110","0000001","0000001","0000001","1111110"); }
      function V() { return bld("1111100","0000010","0000001","0000010","1111100"); }
      function W() { return bld("1111110","0000001","0001110","0000001","1111110"); }
      function X() { return bld("1100011","0010100","0001000","0010100","1100011"); }
      function Y() { return bld("1100000","0010000","0001111","0010000","1100000"); }
      function Z() { return bld("1000011","1000101","1001001","1010001","1100001"); }
      function _0() {return bld("0111110","1010001","1001001","1000101","0111110"); }
      function _1() {return bld("0000000","0100001","1111111","0000001","0000000"); }
      function _2() {return bld("0100001","1000011","1000101","1001001","0110001"); }
      function _3() {return bld("0100010","1000001","1001001","1001001","0110110"); }
      function _4() {return bld("1111000","0001000","0001000","1111111","0001000"); }
      function _5() {return bld("1110010","1001001","1001001","1001001","1000110"); }
      function _6() {return bld("0111110","1001001","1001001","1001001","0100110"); }
      function _7() {return bld("1000001","1000010","1000100","1001000","1110000"); }
      function _8() {return bld("0110110","1001001","1001001","1001001","0110110"); }
      function _9() {return bld("0110010","1001001","1001001","1001001","0111110"); }
      function _exc() {return bld("0000000","0110000","1111101","0110000","0000000"); }
      function _hsh() {return bld("0010100","0111110","0010100","0111110","0010100"); }
      function _dol() {return bld("0010000","0101010","1111111","0101010","0000100"); }
      function _per() {return bld("0110010","0110100","0001000","0010110","0100110"); }
      function _amp() {return bld("0110110","1001001","0110101","0000010","0000101"); }
      function _ast() {return bld("0100100","0011000","0111100","0011000","0100100"); }
      function _op() {return bld("0000000","0111110","1000001","0000000"); }
      function _cp() {return bld("0000000","1000001","0111110","0000000"); }


      function Msg(str, xStart) {
        this.msg = str;
        this.r = 5;
        this.x = xStart;

        Msg.prototype.draw=function(cfg,xPos,yPos) {
          for(var i = 0; i<this.msg.length; i++) {
            if(this.msg[i] == 1) {
              cfg.context.beginPath();
              cfg.context.arc(xPos, 2*this.r*i+this.r+yPos, this.r, 0, 2*Math.PI, false);
              cfg.context.fillStyle = "orange";
              cfg.context.fill();
            }
          }
          this.x -= 2*this.r;
        }
      }

      function init(cfg) {
        //alert(get('msg'));
        cfg.canvas.addEventListener('mousedown', canvasMouseDown, false);
        //cfg.buffer[0] = cfg.buffer[0].concat(A(),B(),C(),D(),E(),F(),G(),H(),I(),J(),K(),L(),M(),N(),O(),P(),Q(),R(),S(),T(),U(),V(),W(),X(),Y(),Z(),_0(),_1(),_2(),_3(),_4(),_5(),_6(),_7(),_8(),_9(),_exc(),_hsh(),_dol(),_per(),_amp(),_ast(),_op(),_cp());
        cfg.buffer[0] = translate(get('msg').toUpperCase());
        //cfg.buffer[1] = cfg.buffer[1].concat(A(),B(),C(),D(),E(),F(),G(),H(),I(),J(),K(),L(),M(),N(),O(),P(),Q(),R(),S(),T(),U(),V(),W(),X(),Y(),Z(),_0(),_1(),_2(),_3(),_4(),_5(),_6(),_7(),_8(),_9(),_exc(),_hsh(),_dol(),_per(),_amp(),_ast(),_op(),_cp());
        for(var i = 0; i<80; i++) {
          cfg.state[0].push(new Msg("0000000000"));
          cfg.state[1].push(new Msg("0000000000"));
        }
        renderNextFrame(meta);
      }

      function getMousePos(cfg, evt) {
        var rect = cfg.canvas.getBoundingClientRect();
        return {
           x: evt.clientX - rect.left,
           y: evt.clientY - rect.top
        };
      } 

      function canvasMouseDown(event) {
        if(meta.enabled) {
          meta.enabled=false;
        }else{
          meta.enabled=true;
        }
        renderNextFrame(meta);
      }

      function renderNextFrame(cfg) {
        cfg.context.clearRect(0, 0, cfg.canvas.width, cfg.canvas.height);
        cfg.generation += 1;
        //TODO: check out the buffering here. possibly skipping a vertical render
        cfg.buffer[0].push(cfg.state[0].shift());
        cfg.buffer[1].push(cfg.state[1].shift());
        drawState(cfg);
        cfg.state[0].push(cfg.buffer[0].shift());
        cfg.state[1].push(cfg.buffer[1].shift());
        if(cfg.enabled) window.setTimeout(renderNextFrame, 1000/cfg.framerate, cfg);
      }

      function drawState(cfg) {
        for(var i = 0; i<cfg.state[0].length; i++) {
          cfg.state[0][i].draw(cfg, 10*i,0);
        }
        for(var i = 0; i<cfg.state[1].length; i++) {
          cfg.state[1][i].draw(cfg, 10*i,80);
        }
      }

      function randomInt(min, max) {
          return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function getSeconds() {
        return new Date().getTime() / 1000;
      }

      function round(number, decimals) {
        return new Number(number+'').toFixed(parseInt(decimals));
      }

      var meta={
        canvas: document.getElementById('scroll'),
        context: document.getElementById('scroll').getContext('2d'),
        origin: {x:document.getElementById('scroll').clientWidth / 2, y:document.getElementById('scroll').clientHeight / 2},
        enabled: true,
        generation: 0,
        framerate: 26,
        state:[[],[]],
        buffer: [[],[]],
      }

      init(meta);

    </script>
  </body>
</html>
